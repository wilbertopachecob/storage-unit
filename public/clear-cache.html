<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Cache - Storage Unit</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1>Clear Cache</h1>
                <div class="alert alert-info">
                    <h5>Clearing all caches and forcing refresh...</h5>
                    <div id="status">Please wait...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function clearAllCaches() {
            const status = document.getElementById('status');
            
            try {
                // Clear Service Worker caches
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(
                        cacheNames.map(cacheName => caches.delete(cacheName))
                    );
                    status.innerHTML += '<br>✅ Service Worker caches cleared';
                }
                
                // Unregister Service Workers
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    await Promise.all(
                        registrations.map(registration => registration.unregister())
                    );
                    status.innerHTML += '<br>✅ Service Workers unregistered';
                }
                
                // Clear localStorage
                localStorage.clear();
                status.innerHTML += '<br>✅ localStorage cleared';
                
                // Clear sessionStorage
                sessionStorage.clear();
                status.innerHTML += '<br>✅ sessionStorage cleared';
                
                status.innerHTML += '<br><br><strong>All caches cleared! Redirecting to main page...</strong>';
                
                // Redirect to main page after 2 seconds
                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);
                
            } catch (error) {
                status.innerHTML += '<br>❌ Error: ' + error.message;
            }
        }
        
        // Run on page load
        document.addEventListener('DOMContentLoaded', clearAllCaches);
    </script>
</body>
</html>